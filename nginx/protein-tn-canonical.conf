# ==============================================================
# protein.tn — Canonical domain redirects (301)
# ==============================================================
# Use with Nginx + Cloudflare. Ensures all traffic ends at https://protein.tn
#
# Include this file from your main nginx.conf (e.g. in http {}):
#   include /path/to/protein-tn-canonical.conf;
#
# Or place under /etc/nginx/conf.d/ (e.g. /etc/nginx/conf.d/protein-tn-canonical.conf).
#
# Ensure your main app server block uses:
#   server_name protein.tn;
#   listen 443 ssl;
#   # ... proxy_pass to Next.js / app ...
# ==============================================================

# ---- 1. WWW → canonical HTTPS (HTTP and HTTPS) ----
# For HTTPS (443): set ssl_certificate* to a cert that covers www.protein.tn
# (e.g. wildcard *.protein.tn). Otherwise Cloudflare will show SSL 525 for https://www.protein.tn.
server {
    listen 80;
    listen 443 ssl http2;
    server_name www.protein.tn;

    # Required for listen 443 ssl — use your real paths (e.g. Let's Encrypt or wildcard)
    ssl_certificate     /etc/nginx/ssl/protein.tn/fullchain.pem;
    ssl_certificate_key /etc/nginx/ssl/protein.tn/privkey.pem;

    return 301 https://protein.tn$request_uri;
}

# ---- 2. Non-WWW: HTTP → HTTPS ----
server {
    listen 80;
    server_name protein.tn;
    return 301 https://protein.tn$request_uri;
}

# ==============================================================
# Main app block (reference only — adjust to your setup)
# Your existing server that serves the site must use server_name protein.tn; e.g.:
#
# server {
#     listen 443 ssl http2;
#     server_name protein.tn;
#     ssl_certificate     /path/to/fullchain.pem;
#     ssl_certificate_key /path/to/privkey.pem;
#     location / {
#         proxy_pass http://127.0.0.1:3001;
#         proxy_http_version 1.1;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }
# }
# ==============================================================
